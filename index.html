<!DOCTYPE html>
<html lang="de-DE">
  <head>
    <meta charset="utf-8">
    <title>ÜdV</title>
    <style>
      body {
        margin: 0;
        width: 100%;
        position: relative;
      }
      #pre-post-show {
        padding: 2rem;
      }
      #show {
        display: flex;
        width: inherit;
      }
      #show-music, #show-sfx {
        width: 50%;
        padding: 2rem;
      }
      .audio-group {
        position: relative;
        margin-bottom: 1rem;
        display: flex;
      }
      .audio-group audio {
        flex-grow: 1;
      }
      .audio-group button {
        width: 30%;
      }
      .audio-group button::before {
        content: '\25BA';
      }
      .audio-group button.playing {
        background-color: orange;
      }
      .audio-group button.playing::before {
        content: '\25A0';
      }
      .audio-group button.playing.reset::before {
        content: '\21BA';
      }
      #my-test {
        margin-top: 5rem;
      }
    </style>
    <script src="js/generic.js"></script>
  </head>
  <body>
    <!-- Somehow the autoplay, muted, loop helps the browser Audio to stay 'active', so freshly run sounds are hearable from the start on -->
    <audio preload="auto" loop muted autoplay>
      <source src="notification.mp3" type="audio/mp3">
    Your browser does not support the audio element.
    </audio>
    <!-- ******************* PRE/POST SHOW START -->
    <div id="pre-post-show">
      <div id="test-multiple-audio" class="audio-group">
        <input type="number" id="loopStart">
        <input type="number" id="loopEnd">
        <button>Click to loop</button>
        <audio controls preload="auto">
          <source src="manhattan lounge band - all of me.mp3" type="audio/mp3">
        Your browser does not support the audio element.
        </audio>
        <script type="text/javascript">
          // STATE
          let loop = false;
          let tO;

          // defining the loop (initially)
          let loopStart = 74566;
          let loopEnd = 78217;

          // DOM
          const btn = document.getElementById("test-multiple-audio").querySelector("button");
          const audio = document.getElementById("test-multiple-audio").querySelector("audio");
          const loopStartInput = document.getElementById("loopStart");
          const loopEndInput = document.getElementById("loopEnd");

          // Trigger Loop ON/OFF
          btn.addEventListener("click", () => {
            // Activate Loop
            if (!loop) {
              loop = true;
              btn.classList.add("playing");
              btn.textContent = "Loop is active";
              return;
            }
            // Exit Loop
            if (loop) {
              loop = false;
              btn.classList.remove("playing");
              btn.textContent = "Click to loop";
              if (tO) {
                clearTimeout(tO);
                tO = undefined;
              }
              return;
            }
          });

          // Listen on timeupdate of audio to find looping timing.
          audio.addEventListener("timeupdate", ({srcElement: {currentTime}}) => {
            if (!loop || tO) {
              // Not looping, or timeout is already set
              return;
            }
            const loopEndsIn = loopEnd - audio.currentTime * 1000;
            if (loopEndsIn > 1000 || loopEndsIn < 0) {
              // Too soon to add trigger OR loopEnd has already passed.
              return;
            }
            tO = setTimeout(() => {
              audio.currentTime = loopStart / 1000;
              clearTimeout(tO);
              tO = undefined;
            }, loopEndsIn);
          });

          // INPUT controls for loop
          // Set Initial value to the preset
          loopStartInput.value = loopStart;
          loopEndInput.value = loopEnd;

          // Listen for changes in input field and reflect to JS state.
          loopStartInput.addEventListener("change", (ev) => {
            loopStart = ev.target.value;
          });
          loopEndInput.addEventListener("change", (ev) => {
            loopEnd = ev.target.value;
          });
        </script>
      </div>
      <div id="pre-show-jazz" class="audio-group">
        <button>Pre-/Post-Show</button>
        <audio controls preload="auto" loop>
          <source src="preshow jazz.mp3" type="audio/mp3">
        Your browser does not support the audio element.
        </audio>
        <script type="text/javascript">new StoppableAudio("pre-show-jazz");</script>
      </div>
    </div>
    <!-- ******************* PRE/POST SHOW END -->
    <!-- ******************* SHOW START -->
    <div id="show">
      <!-- ******************* SOUND EFFECTS START -->
      <div id="show-sfx">
        <div id="doorbell" class="audio-group">
          <button>Türklingel</button>
          <audio controls preload="auto">
            <source src="Doorbell.mp3" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
          <script type="text/javascript">new SoundEffect("doorbell");</script>
        </div>
        <div id="notification" class="audio-group">
          <button>Notification</button>
          <audio controls preload="auto">
            <source src="notification.mp3" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
          <script type="text/javascript">new SoundEffect("notification");</script>
        </div>
        <div id="skype_ringing" class="audio-group">
          <button>Skype Anruf</button>
          <audio controls preload="auto" loop>
            <source src="Skype -  Ringtone.mp3" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
          <script type="text/javascript">new StoppableAudio("skype_ringing");</script>
        </div>
        <div id="skype_auflegen" class="audio-group">
          <button>Skype Auflegen</button>
          <audio controls preload="auto">
            <source src="Skype - End Call.mp3" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
          <script type="text/javascript">new SoundEffect("skype_auflegen");</script>
        </div>
      </div>
      <!-- ******************* SOUND EFFECTS END -->
  
      <!-- ******************* MUSIC START -->
      <div id="show-music">
        <div id="zaz" class="audio-group">
          <button>Zaz - Je Veux</button>
          <audio controls preload="auto">
            <source src="zaz - je veux.mp3" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
          <script type="text/javascript">new StoppableAudio("zaz");</script>
        </div>
        <div id="all_of_me" class="audio-group">
          <button>Manhattan LB - All Of Me</button>
          <audio controls preload="auto">
            <source src="manhattan lounge band - all of me.mp3" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
          <script type="text/javascript">new StoppableAudio("all_of_me");</script>
        </div>
        <div id="maske01" class="audio-group">
          <button>Maske 01</button>
          <audio controls preload="auto">
            <source src="Maske 01 - I'll See You In My Dreams.mp3" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
          <script type="text/javascript">new StoppableAudio("maske01");</script>
        </div>
        <div id="autumn_atmo" class="audio-group">
          <button>Herbst Atmo</button>
          <audio controls preload="auto" loop>
            <source src="autumn atmo.mp3" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
          <script type="text/javascript">new StoppableAudio("autumn_atmo");</script>
        </div>
        <div id="ausgehfein" class="audio-group">
          <button>Ausgeh-Fein</button>
          <audio controls preload="auto">
            <source src="Soft positive guitar then piano - Demi-Lune.mp3" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
          <script type="text/javascript">new StoppableAudio("ausgehfein");</script>
        </div>
      </div>
      <!-- ******************* MUSIC END -->
    </div>
    <!-- ******************* SHOW END -->
    <div id="my-test">
      <div class="audio-group" id="my-test-loop">
        <button>Loop</button>
        <audio controls preload="auto" loop>
          <source src="loop.mp3" type="audio/mp3">
        Your browser does not support the audio element.
        </audio>
      </div>
      <div class="audio-group" id="my-test-end">
        <button>Exit-Loop</button>
        <audio controls preload="auto">
          <source src="post-loop.mp3" type="audio/mp3">
        Your browser does not support the audio element.
        </audio>
      </div>
      <div>
        <button>Stop</button>
      </div>
      <script type="text/javascript">new QuitableLoop("my-test-loop", "my-test-end");</script>
    </div>
  </body>
</html>
